<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="$ver = $host | select version&#xD;&#xA;if($Ver.version.major -gt 1) {$Host.Runspace.ThreadOptions = &quot;ReuseThread&quot;}&#xD;&#xA;if(!(Get-PSSnapin Microsoft.SharePoint.PowerShell -ea 0))&#xD;&#xA;{&#xD;&#xA;Write-Progress -Activity &quot;Loading Modules&quot; -Status &quot;Loading Microsoft.SharePoint.PowerShell&quot;&#xD;&#xA;Add-PSSnapin Microsoft.SharePoint.PowerShell&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;##&#xD;&#xA;#Set Static Variables&#xD;&#xA;##&#xD;&#xA;&#xD;&#xA;$SourceWebURL = &quot;http://www.contoso.com&quot;&#xD;&#xA;$SourceLibraryTitle = &quot;Shared Documents&quot;&#xD;&#xA;$DestinationWebURL = &quot;http://archive.contoso.com/WWWArchive&quot;&#xD;&#xA;$DestinationLibraryTitle = &quot;Shared Documents&quot;&#xD;&#xA;&#xD;&#xA;##&#xD;&#xA;#Begin Script&#xD;&#xA;##&#xD;&#xA;&#xD;&#xA;$sWeb = Get-SPWeb $SourceWebURL&#xD;&#xA;$sList = $sWeb.Lists | ? {$_.Title -eq $SourceLibraryTitle}&#xD;&#xA;$dWeb = Get-SPWeb $DestinationWebURL&#xD;&#xA;$dList = $dWeb.Lists | ? {$_.title -like $DestinationLibraryTitle}&#xD;&#xA;&#xD;&#xA;$AllFolders = $sList.Folders&#xD;&#xA;$RootFolder = $sList.RootFolder&#xD;&#xA;$RootItems = $RootFolder.files&#xD;&#xA;&#xD;&#xA;foreach($RootItem in $RootItems)&#xD;&#xA;{&#xD;&#xA;    $sBytes = $RootItem.OpenBinary()&#xD;&#xA;    $dFile = $dList.RootFolder.Files.Add($RootItem.Name, $sBytes, $true)&#xD;&#xA;&#xD;&#xA;    $AllFields = $RootItem.Item.Fields | ? {!($_.sealed)}&#xD;&#xA;&#xD;&#xA;    foreach($Field in $AllFields)&#xD;&#xA;    {&#xD;&#xA;        if($RootItem.Properties[$Field.Title])&#xD;&#xA;        {&#xD;&#xA;            if(!($dFile.Properties[$Field.title]))&#xD;&#xA;            {&#xD;&#xA;                $dFile.AddProperty($Field.Title, $RootItem.Properties[$Field.Title])&#xD;&#xA;            }&#xD;&#xA;            else&#xD;&#xA;            {&#xD;&#xA;                $dFile.Properties[$Field.Title] = $RootItem.Properties[$Field.Title]&#xD;&#xA;            }&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;    $dFile.Update()&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;foreach($Folder in $AllFolders)&#xD;&#xA;{&#xD;&#xA;    Remove-Variable ParentFolderURL&#xD;&#xA;    $i = 0&#xD;&#xA;    &#xD;&#xA;    $FolderURL = $Folder.url.Split(&quot;/&quot;)&#xD;&#xA;        &#xD;&#xA;    while($i -lt ($FolderURL.count-1))&#xD;&#xA;    {&#xD;&#xA;    $ParentFolderURL = &quot;$ParentFolderURL/&quot; + $FolderURL[$i]&#xD;&#xA;    $i++&#xD;&#xA;    }&#xD;&#xA;    &#xD;&#xA;    $CurrentFolder = $dList.Folders | ? {$_.url -eq $ParentFolderURL.substring(1)}&#xD;&#xA;    if(!($CurrentFolder.Folders | ? {$_.name -eq $Folder.Name}))&#xD;&#xA;    {&#xD;&#xA;        $NewFolder = $dlist.Folders.Add((&quot;$DestinationWebURL&quot; + $ParentFolderURL), [Microsoft.SharePoint.SPFileSystemObjectType]::Folder, $Folder.name)&#xD;&#xA;        $NewFolder.update()&#xD;&#xA;    }&#xD;&#xA;    else&#xD;&#xA;    {&#xD;&#xA;        $NewFolder = $dList.Folders | ? {$_.name -eq $Folder.Name}&#xD;&#xA;    }&#xD;&#xA;    $AllFiles = $sList.Items&#xD;&#xA;    $sItems = $Folder.folder.Files&#xD;&#xA;    &#xD;&#xA;    if($Folder.Folder.Files.count -gt 0)&#xD;&#xA;    {&#xD;&#xA;        foreach($item in $sItems)&#xD;&#xA;        {&#xD;&#xA;            &#xD;&#xA;            $Relative = ($Item.ServerRelativeUrl).substring(1)&#xD;&#xA;            $TargetItem = $AllFiles | ? {$_.URL -eq $Relative}&#xD;&#xA;            $sBytes = $TargetItem.File.OpenBinary()&#xD;&#xA;            $dFile = $Newfolder.Folder.Files.Add($TargetItem.Name, $sBytes, $true)&#xD;&#xA;            $AllFields = $TargetItem.Fields | ? {!($_.sealed)}&#xD;&#xA;            &#xD;&#xA;            foreach($Field in $AllFields)&#xD;&#xA;            {&#xD;&#xA;                if($TargetItem.Properties[$Field.Title])&#xD;&#xA;                {&#xD;&#xA;                    if(!($dFile.Properties[$Field.title]))&#xD;&#xA;                    {&#xD;&#xA;                        $dFile.AddProperty($Field.Title, $TargetItem.Properties[$Field.Title])&#xD;&#xA;                    }&#xD;&#xA;                    else&#xD;&#xA;                    {&#xD;&#xA;                        $dFile.Properties[$Field.Title] = $TargetItem.Properties[$Field.Title]&#xD;&#xA;                    }&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;            $dFile.Update()&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;}" />
  <Code Content="$ver = $host | select version&#xD;&#xA;if($Ver.version.major -gt 1) {$Host.Runspace.ThreadOptions = &quot;ReuseThread&quot;}&#xD;&#xA;if(!(Get-PSSnapin Microsoft.SharePoint.PowerShell -ea 0))&#xD;&#xA;{&#xD;&#xA;Write-Progress -Activity &quot;Loading Modules&quot; -Status &quot;Loading Microsoft.SharePoint.PowerShell&quot;&#xD;&#xA;Add-PSSnapin Microsoft.SharePoint.PowerShell&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;##&#xD;&#xA;#Set Static Variables&#xD;&#xA;##&#xD;&#xA;&#xD;&#xA;$SourceWebURL = &quot;http://www.contoso.com&quot;&#xD;&#xA;$SourceLibraryTitle = &quot;Shared Documents&quot;&#xD;&#xA;$DestinationWebURL = &quot;http://archive.contoso.com/WWWArchive&quot;&#xD;&#xA;$DestinationLibraryTitle = &quot;Shared Documents&quot;&#xD;&#xA;&#xD;&#xA;##&#xD;&#xA;#Begin Script&#xD;&#xA;##&#xD;&#xA;&#xD;&#xA;$sWeb = Get-SPWeb $SourceWebURL&#xD;&#xA;$sList = $sWeb.Lists | ? {$_.Title -eq $SourceLibraryTitle}&#xD;&#xA;$dWeb = Get-SPWeb $DestinationWebURL&#xD;&#xA;$dList = $dWeb.Lists | ? {$_.title -like $DestinationLibraryTitle}&#xD;&#xA;&#xD;&#xA;$AllFolders = $sList.Folders&#xD;&#xA;$RootFolder = $sList.RootFolder&#xD;&#xA;$RootItems = $RootFolder.files&#xD;&#xA;&#xD;&#xA;foreach($RootItem in $RootItems)&#xD;&#xA;{&#xD;&#xA;    $sBytes = $RootItem.OpenBinary()&#xD;&#xA;    $dFile = $dList.RootFolder.Files.Add($RootItem.Name, $sBytes, $true)&#xD;&#xA;&#xD;&#xA;    $AllFields = $RootItem.Item.Fields | ? {!($_.sealed)}&#xD;&#xA;&#xD;&#xA;    foreach($Field in $AllFields)&#xD;&#xA;    {&#xD;&#xA;        if($RootItem.Properties[$Field.Title])&#xD;&#xA;        {&#xD;&#xA;            if(!($dFile.Properties[$Field.title]))&#xD;&#xA;            {&#xD;&#xA;                $dFile.AddProperty($Field.Title, $RootItem.Properties[$Field.Title])&#xD;&#xA;            }&#xD;&#xA;            else&#xD;&#xA;            {&#xD;&#xA;                $dFile.Properties[$Field.Title] = $RootItem.Properties[$Field.Title]&#xD;&#xA;            }&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;    $dFile.Update()&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;foreach($Folder in $AllFolders)&#xD;&#xA;{&#xD;&#xA;    Remove-Variable ParentFolderURL&#xD;&#xA;    $i = 0&#xD;&#xA;    &#xD;&#xA;    $FolderURL = $Folder.url.Split(&quot;/&quot;)&#xD;&#xA;        &#xD;&#xA;    while($i -lt ($FolderURL.count-1))&#xD;&#xA;    {&#xD;&#xA;    $ParentFolderURL = &quot;$ParentFolderURL/&quot; + $FolderURL[$i]&#xD;&#xA;    $i++&#xD;&#xA;    }&#xD;&#xA;    &#xD;&#xA;    $CurrentFolder = $dList.Folders | ? {$_.url -eq $ParentFolderURL.substring(1)}&#xD;&#xA;    if(!($CurrentFolder.Folders | ? {$_.name -eq $Folder.Name}))&#xD;&#xA;    {&#xD;&#xA;        $NewFolder = $dlist.Folders.Add((&quot;$DestinationWebURL&quot; + $ParentFolderURL), [Microsoft.SharePoint.SPFileSystemObjectType]::Folder, $Folder.name)&#xD;&#xA;        $NewFolder.update()&#xD;&#xA;    }&#xD;&#xA;    else&#xD;&#xA;    {&#xD;&#xA;        $NewFolder = $dList.Folders | ? {$_.name -eq $Folder.Name}&#xD;&#xA;    }&#xD;&#xA;    $AllFiles = $sList.Items&#xD;&#xA;    $sItems = $Folder.folder.Files&#xD;&#xA;    &#xD;&#xA;    if($Folder.Folder.Files.count -gt 0)&#xD;&#xA;    {&#xD;&#xA;        foreach($item in $sItems)&#xD;&#xA;        {&#xD;&#xA;            &#xD;&#xA;            $Relative = ($Item.ServerRelativeUrl).substring(1)&#xD;&#xA;            $TargetItem = $AllFiles | ? {$_.URL -eq $Relative}&#xD;&#xA;            $sBytes = $TargetItem.File.OpenBinary()&#xD;&#xA;            $dFile = $Newfolder.Folder.Files.Add($TargetItem.Name, $sBytes, $true)&#xD;&#xA;            $AllFields = $TargetItem.Fields | ? {!($_.sealed)}&#xD;&#xA;            &#xD;&#xA;            foreach($Field in $AllFields)&#xD;&#xA;            {&#xD;&#xA;                if($TargetItem.Properties[$Field.Title])&#xD;&#xA;                {&#xD;&#xA;                    if(!($dFile.Properties[$Field.title]))&#xD;&#xA;                    {&#xD;&#xA;                        $dFile.AddProperty($Field.Title, $TargetItem.Properties[$Field.Title])&#xD;&#xA;                    }&#xD;&#xA;                    else&#xD;&#xA;                    {&#xD;&#xA;                        $dFile.Properties[$Field.Title] = $TargetItem.Properties[$Field.Title]&#xD;&#xA;                    }&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;            $dFile.Update()&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;}" />
</CodeSnippets>