<?xml version="1.0" encoding="utf-8"?>
<CodeSnippets>
  <Code Content="#-------------------------------------------------------------------------------------------&#xD;&#xA;# Name:&#x9;&#x9;&#x9;Get-WASummaryReport&#xD;&#xA;# Description: &#x9;This script will get the Web Analytics Summary Report&#xD;&#xA;# Usage:&#x9;&#x9;Run the function with the required parameters&#xD;&#xA;#&#x9;&#x9;&#x9;&#x9;Context can be SPWebApplication, SPSite or SPWeb&#xD;&#xA;# By: &#x9;&#x9;&#x9;Ivan Josipovic, softlanding.ca&#xD;&#xA;#-------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Function Get-WASummaryReport($Context,$DaysToGoBack){&#xD;&#xA;&#x9;Add-PSSnapin Microsoft.SharePoint.PowerShell -ea 0;&#xD;&#xA;&#x9;[System.Reflection.Assembly]::Load(&quot;Microsoft.Office.Server.WebAnalytics, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&quot;) | Out-Null;&#xD;&#xA;&#x9;[System.Reflection.Assembly]::Load(&quot;Microsoft.Office.Server.WebAnalytics.UI, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&quot;) | Out-Null;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;Function DateTimeToDateId ([System.DateTime]$dt){&#xD;&#xA;&#x9;&#x9;if (![System.String]::IsNullOrEmpty($dt.ToString())){&#xD;&#xA;&#x9;&#x9;&#x9;return [System.Int32]::Parse($dt.ToString(&quot;yyyyMMdd&quot;, [System.Globalization.CultureInfo]::InvariantCulture), [System.Globalization.CultureInfo]::InvariantCulture);&#xD;&#xA;&#x9;&#x9;}else{&#xD;&#xA;&#x9;&#x9;&#x9;return 0;&#xD;&#xA;&#x9;&#x9;}&#xD;&#xA;&#x9;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;#Not used in this report but other report types require it.&#xD;&#xA;&#x9;Function GetSortOrder([String]$sortColumn,[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.OrderType]$order){&#xD;&#xA;&#x9;&#x9;$SortOrders = New-Object System.Collections.Generic.List[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.SortOrder];&#xD;&#xA;&#x9;&#x9;$sortOrders.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.SortOrder($sortColumn, $order)));&#xD;&#xA;&#x9;&#x9;return ,$SortOrders&#xD;&#xA;&#x9;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;$AggregationContext = [Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.AggregationContext]::GetContext($Context);&#xD;&#xA;&#x9;if (!$?){throw &quot;Cant get the Aggregation Context&quot;;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;$viewParamsList = New-Object System.Collections.Generic.List[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue]&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;PreviousStartDateId&quot;, (DateTimeToDateId([System.DateTime]::UtcNow.AddDays(-($DaysToGoBack * 2)))))));&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;CurrentStartDateId&quot;, (DateTimeToDateId([System.DateTime]::UtcNow.AddDays(-($DaysToGoBack)))))));&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;Duration&quot;, $DaysToGoBack)));&#xD;&#xA;&#xD;&#xA;&#x9;$dataPacket = [Microsoft.Office.Server.WebAnalytics.Reporting.FrontEndDataRetriever]::QueryData($AggregationContext, $null, &quot;fn_WA_GetSummary&quot;, $viewParamsList, $null, $null, 1, 25000, $False);&#xD;&#xA;&#x9;if (!$?){throw &quot;Unable to get the Data. Try running the script as the Farm Account. If that doesnt work, make sure that the Web Analytics Service Application is connected to the Web Application and that the Site Web Analytics reports work through the browser.&quot;;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;return $dataPacket.DataTable&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;$WebApp = Get-SPWebApplication http://sp.client.com&#xD;&#xA;$Site = Get-SPSite http://sp.client.com&#xD;&#xA;$Web = Get-SPWeb http://sp.client.com&#xD;&#xA;&#xD;&#xA;Get-WASummaryReport -Context $WebApp -DaysToGoBack 30 &#xD;&#xA;Get-WASummaryReport -Context $Site -DaysToGoBack 30&#xD;&#xA;Get-WASummaryReport -Context $Web -DaysToGoBack 30&#xD;&#xA;" />
  <Code Content="#-------------------------------------------------------------------------------------------&#xD;&#xA;# Name:&#x9;&#x9;&#x9;Get-WASummaryReport&#xD;&#xA;# Description: &#x9;This script will get the Web Analytics Summary Report&#xD;&#xA;# Usage:&#x9;&#x9;Run the function with the required parameters&#xD;&#xA;#&#x9;&#x9;&#x9;&#x9;Context can be SPWebApplication, SPSite or SPWeb&#xD;&#xA;# By: &#x9;&#x9;&#x9;Ivan Josipovic, softlanding.ca&#xD;&#xA;#-------------------------------------------------------------------------------------------&#xD;&#xA;&#xD;&#xA;Function Get-WASummaryReport($Context,$DaysToGoBack){&#xD;&#xA;&#x9;Add-PSSnapin Microsoft.SharePoint.PowerShell -ea 0;&#xD;&#xA;&#x9;[System.Reflection.Assembly]::Load(&quot;Microsoft.Office.Server.WebAnalytics, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&quot;) | Out-Null;&#xD;&#xA;&#x9;[System.Reflection.Assembly]::Load(&quot;Microsoft.Office.Server.WebAnalytics.UI, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&quot;) | Out-Null;&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;Function DateTimeToDateId ([System.DateTime]$dt){&#xD;&#xA;&#x9;&#x9;if (![System.String]::IsNullOrEmpty($dt.ToString())){&#xD;&#xA;&#x9;&#x9;&#x9;return [System.Int32]::Parse($dt.ToString(&quot;yyyyMMdd&quot;, [System.Globalization.CultureInfo]::InvariantCulture), [System.Globalization.CultureInfo]::InvariantCulture);&#xD;&#xA;&#x9;&#x9;}else{&#xD;&#xA;&#x9;&#x9;&#x9;return 0;&#xD;&#xA;&#x9;&#x9;}&#xD;&#xA;&#x9;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;#Not used in this report but other report types require it.&#xD;&#xA;&#x9;Function GetSortOrder([String]$sortColumn,[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.OrderType]$order){&#xD;&#xA;&#x9;&#x9;$SortOrders = New-Object System.Collections.Generic.List[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.SortOrder];&#xD;&#xA;&#x9;&#x9;$sortOrders.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.SortOrder($sortColumn, $order)));&#xD;&#xA;&#x9;&#x9;return ,$SortOrders&#xD;&#xA;&#x9;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;$AggregationContext = [Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.AggregationContext]::GetContext($Context);&#xD;&#xA;&#x9;if (!$?){throw &quot;Cant get the Aggregation Context&quot;;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;$viewParamsList = New-Object System.Collections.Generic.List[Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue]&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;PreviousStartDateId&quot;, (DateTimeToDateId([System.DateTime]::UtcNow.AddDays(-($DaysToGoBack * 2)))))));&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;CurrentStartDateId&quot;, (DateTimeToDateId([System.DateTime]::UtcNow.AddDays(-($DaysToGoBack)))))));&#xD;&#xA;&#x9;$viewParamsList.Add((New-Object Microsoft.Office.Server.WebAnalytics.ProcessedDataRetriever.ViewParameterValue(&quot;Duration&quot;, $DaysToGoBack)));&#xD;&#xA;&#xD;&#xA;&#x9;$dataPacket = [Microsoft.Office.Server.WebAnalytics.Reporting.FrontEndDataRetriever]::QueryData($AggregationContext, $null, &quot;fn_WA_GetSummary&quot;, $viewParamsList, $null, $null, 1, 25000, $False);&#xD;&#xA;&#x9;if (!$?){throw &quot;Unable to get the Data. Try running the script as the Farm Account. If that doesnt work, make sure that the Web Analytics Service Application is connected to the Web Application and that the Site Web Analytics reports work through the browser.&quot;;}&#xD;&#xA;&#x9;&#xD;&#xA;&#x9;return $dataPacket.DataTable&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;$WebApp = Get-SPWebApplication http://sp.client.com&#xD;&#xA;$Site = Get-SPSite http://sp.client.com&#xD;&#xA;$Web = Get-SPWeb http://sp.client.com&#xD;&#xA;&#xD;&#xA;Get-WASummaryReport -Context $WebApp -DaysToGoBack 30 &#xD;&#xA;Get-WASummaryReport -Context $Site -DaysToGoBack 30&#xD;&#xA;Get-WASummaryReport -Context $Web -DaysToGoBack 30&#xD;&#xA;" />
</CodeSnippets>