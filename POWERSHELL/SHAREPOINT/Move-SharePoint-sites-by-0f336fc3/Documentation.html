<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <title>Move SharePoint sites by PowerShell script</title>        
        <meta name="description" content="Sometimes we should move SharePoint sites from a content database to another, because run out of the free space on the file group where the content database datafiles are stay. Just take a backup from sites what you want to move to another content database and restore." />
        <link href="https://i1.code.msdn.s-msft.com/RequestReduceContent/c82dc8ab865be0fb7316b2e09ac97654-bafb67d64bd55a2b1fd123070a82b424-RequestReducedStyle.css" rel="Stylesheet" type="text/css" />        
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.6.1.min.js" type="text/javascript" ></script>
        <script src="https://i1.code.msdn.s-msft.com/RequestReduceContent/a12c72272a8fe142a00d8aae0ff5525e-cf9957f54e208c66abb738158989dd84-RequestReducedScript.js" type="text/javascript" ></script>                        <script type="text/javascript">
            function initializePage() {
                var activeTabData = 'activeTab';
                var otherTabClass = 'otherTab';
                var hiddenPreClass = 'hidden';
                $("a[href^=#]").attr("target","_self");
                $("div.scriptcode").each(function (i) {
                    var scriptBlock = $(this);
                    scriptBlock.trackCopy(trackCodeSnippetCodeDownload);
                    var labelElems = scriptBlock.find("div.title > span");
                    if (labelElems.length == 0) {
                        labelElems = scriptBlock.find("div.title");
                    }
                    var languageSpans = scriptBlock.find("span.hidden");
                    var pres = scriptBlock.find("pre");
                    if (languageSpans.length > 0 && pres.length > 1) {
                        labelElems.each(function(index, elem) {
                            var codePre = $(pres[index]);
                            var labelSpan = $(elem);
                            var languageSpan = $(languageSpans[index]);
                            labelSpan.data('code', codePre.text().replace(/(\r(\n)?)|((\r)?\n)/ig, '\r\n'));
                            codePre.removeClass(hiddenPreClass);  
                            codePre.addClass(languageSpan.text().replace(/^\s+|\s+$/g,""));
                            codePre.chili();
                            languageSpan.remove();
                        });

                        pres = scriptBlock.find("pre");
                        labelElems.each(function(index, elem) {
                            var codePre = $(pres[index]);
                            var labelSpan = $(elem);
                            if (index == 0) {
                                scriptBlock.data(activeTabData, 0);
                            }
                            else {
                                labelSpan.addClass(otherTabClass);
                                codePre.addClass(hiddenPreClass);  
                            }
                            labelSpan.click(function (e) {
                                var activeTab = scriptBlock.data(activeTabData);
                                $(labelElems[activeTab]).addClass(otherTabClass);   
                                $(pres[activeTab]).addClass(hiddenPreClass);   
                                        
                                codePre.removeClass(hiddenPreClass);    
                                labelSpan.removeClass(otherTabClass);
                                scriptBlock.data(activeTabData, index);

                                if( window.parent.Galleries ) {
                                    window.parent.Galleries.project.resizeDesc();
                                }
                            });
                        });

                        var preview = scriptBlock.find('div.preview');
                        if (preview.length == 0) {
                            preview = $(pres[pres.length - 1]);
                        }
                        preview.remove();

                        if (window.clipboardData && clipboardData.setData) {
                            var copyLink = $("<a href='#' class='copyCode'>Copy code</a>");
                            copyLink.click(function (e) {
                                trackCodeSnippetCodeDownload();
                                clipboardData.setData("Text", $(labelElems[scriptBlock.data(activeTabData)]).data('code'));
                                return false;
                            });
                            $(this).prepend(copyLink);
                        }
                    }
                });

                if ((window.parent) && (window.parent.Galleries)) {
                    window.parent.Galleries.project.resizeDesc();
                }

                    if (top.location == self.location) {
                         window.location.replace(window.location.href.replace('/description', ''));
                    }
            }

            function trackCodeSnippetCodeDownload() {
                if ((window.parent) && (window.parent.gTracker)) {
                    window.parent.gTracker.createActionEvent('Description', 'Download', 'Copy', 'CodeSnippet', null);
                }
            }
            
            function overrideAnchorLinksForFirefoxAndChrome(iframeId) {
                if(($.browser.mozilla && parseInt($.browser.version, 10) >= 2) || $.browser.webkit) {
                    var iframeOffset = $("#" + iframeId, window.parent.document).offset();
                    $("a").each(function () {
                        var link = $(this);
                        var href = link.attr("href");
                        if (href && href[0] == "#") {
                            var name = href.substring(1);
                            $(this).click(function () {
                                var nameElement = $("[name='" + name + "']");
                                var idElement = $("#" + name);
                                var element = null;
                                if (nameElement.length > 0) {
                                    element = nameElement;
                                } else if (idElement.length > 0) {
                                    element = idElement;
                                }

                                if (element) {
                                    var offset = element.offset();
                                    window.parent.scrollTo(offset.left, offset.top + iframeOffset.top);
                                }

                                return false;
                            });
                        }
                    });
                }
            }

            $(window).load(function(){
                initializePage();
                overrideAnchorLinksForFirefoxAndChrome("longdescIframe");

            });

        </script>
        <base target="_parent" />
    </head>
    <body>
        <div id="longDesc">
            
<p>Sometimes we should move SharePoint sites from a content database to another, because run out of the free space&nbsp;on the file group where the content database datafiles are stay. Just take a backup from sites what you want to move to another content database
 and restore these are if the backup successfully and you deleted before. You can use this script for just backup, delete and restore multiple sites. When you use it for backup, check the connections between sites and backup files.</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>PowerShell</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">powershell</span>
<pre class="hidden">param (
    [Parameter(Mandatory=$true)]
    [string]$importfile = &quot;&quot;,
    [string]$logpath = &quot;&quot;
    )

#Check SharePoint major build version.    
[Void][System.Reflection.Assembly]::LoadWithPartialName(&quot;Microsoft.SharePoint&quot;)
$SPFarm = [Microsoft.SharePoint.Administration.SPfarm]::Local
$version = $SPFarm.BuildVersion.Major

#Set up the STSADM command path regarding what is the major build version
$stsadmpath = &quot;c:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\$version\BIN\&quot;

#Set location where we are.
$location = Get-Location
Set-Location $location

#Create a log folder if we signed, anyway set it default location.
if ($logpath -ne &quot;&quot;) 
    {New-Item -ItemType directory -Path $logpath -erroraction SilentlyContinue | 
    Write-Host &gt; $null }
    else
    {$logpath &#43;= $location}

#Start working...
$title = &quot;Work with SP sites&quot;
$message = &quot;What do you want to do with the site collection?&quot;

#Create all choice for jobs as backup, delete, restore and quite.
$backup = New-Object System.Management.Automation.Host.ChoiceDescription &quot;&amp;Backup&quot;, `
    &quot;Backup all site collection from source list.&quot;

$delete = New-Object System.Management.Automation.Host.ChoiceDescription &quot;&amp;Delete&quot;, `
    &quot;Delete all site collection from source list.&quot;
    
$restore = New-Object System.Management.Automation.Host.ChoiceDescription &quot;&amp;Restore&quot;, `
    &quot;Restore all site collection from source list.&quot;

$quit = New-Object System.Management.Automation.Host.ChoiceDescription &quot;&amp;Quit&quot;, `
    &quot;Quit.&quot;    
   
#Initiate the menu.
$options = [System.Management.Automation.Host.ChoiceDescription[]]($backup, $delete, $restore, $quit)

#Do the jobs until you want to quit.
:OuterLoop do
{
 #Initiate a prompt for choice.
 $result = $host.ui.PromptForChoice($title, $message, $options, 0) 
 
 #Do the job what you choose.
 switch ($result)
  {	
   #Create a backup from all site collection what are in the .csv file.
   0 {&quot;BACKUP&quot;
     $DateStr = &quot;{0:ddMMyyyyhhmmss}&quot; -f (get-date)
     $stsadmpath
     Write-Host -ForegroundColor green &quot;Opening SharePoint site...&quot;

     ipcsv $importfile | 
     foreach {
        Set-Location $stsadmpath
        $site = $_.Site
        $file = &quot;$location\&quot; &#43; $_.Site.Replace(&quot;http://&quot;,&quot;&quot;).Replace(&quot;https://&quot;,&quot;&quot;).Replace(&quot;/&quot;,&quot;_&quot;).Replace(&quot;;&quot;,&quot;_&quot;) &#43; &quot;.bak&quot;
        $result = .\stsadm.exe -o backup -url $site -filename $file -overwrite
        $DateStrForLog = &quot;{0:dd/MM/yyyy hh:mm:ss}&quot; -f (get-date)
        if ($result -eq &quot;Operation completed successfully.&quot;)
            {
            write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
            write-host -ForegroundColor green  &quot;The &quot; -nonewline 
            write-host -ForegroundColor magenta $site -nonewline 
            write-host -ForegroundColor green &quot; has been backed up to &quot; -nonewline
            write-host -ForegroundColor yellow $file -nonewline
            write-host -ForegroundColor green `n $result
            $logentry = &quot;[$DateStrForLog] The $site has been backed up to `&quot;$file`&quot;&quot; | 
            out-file $logpath\$DateStr&quot;-backup.log&quot; -Append
            $result | out-file $logpath\$DateStr&quot;-backup.log&quot; -Append
            }
            else
            {
            write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
            write-host -ForegroundColor green &quot;The &quot; -nonewline
            write-host -ForegroundColor red $site -nonewline
            write-host -ForegroundColor green &quot; site could not be found!&quot; `n $result
            $logentry = &quot;[$DateStrForLog] The $site site could not be found!&quot; | 
			out-file $logpath\$DateStr&quot;-backup.log&quot; -Append
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-backup.log&quot; -Append                        
            $result = &quot;The site not found!&quot; | 
            out-file $logpath\$DateStr&quot;-backup.log&quot; -Append
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-backup.log&quot; -Append
            $site | out-file $logpath\$DateStr&quot;-sitesnotfound.log&quot; -Append                        
	        }
        }
        Write-Host -ForegroundColor green &quot;Done.&quot;
        Set-Location $location
     }
		
   #Delete all site collection what are in the .csv file
   1 {&quot;DELETE&quot;
     $DateStr = &quot;{0:ddMMyyyyhhmmss}&quot; -f (get-date)
     $stsadmpath
     Write-Host -ForegroundColor green &quot;Opening SharePoint site...&quot;

     ipcsv $importfile | 
     foreach {
        Set-Location $stsadmpath
        $site = $_.Site
        $result = .\stsadm.exe -o deletesite -url $site
        $DateStrForLog = &quot;{0:dd/MM/yyyy hh:mm:ss}&quot; -f (get-date)
        if ($result -eq &quot;Operation completed successfully.&quot;)
        	{
            write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
            write-host -ForegroundColor green  &quot;The &quot; -nonewline 
            write-host -ForegroundColor magenta $site -nonewline
            write-host -ForegroundColor green &quot; has been deleted! &quot; `n $result 
            $logentry = &quot;[$DateStrForLog] The $site has been deleted!&quot; | 
            out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            $result | out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            }
            else
            {
            write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
            write-host -ForegroundColor green &quot;The &quot; -nonewline
            write-host -ForegroundColor red $site -nonewline
            write-host -ForegroundColor green &quot; site could not be found!&quot; `n $result
            $logentry = &quot;[$DateStrForLog] The $site site could not be found! $result&quot; | 
            out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            $result = &quot;The site not found!&quot; |  
			out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-delete.log&quot; -Append
            $site | out-file $logpath\$DateStr&quot;-sitesnotfound.log&quot; -Append
            }
        }
        write-host -ForegroundColor green &quot;Done.&quot;
        Set-Location $location
     }
		  
	#Restore all site collection what are in the .csv file. 
	#WARNING: Check the connection of sites and backups!  
    2 {&quot;RESTORE&quot;
      $DateStr = &quot;{0:ddMMyyyyhhmmss}&quot; -f (get-date)
      $stsadmpath
      Write-Host -ForegroundColor green &quot;Opening SharePoint site...&quot;

      ipcsv $importfile | 
      foreach {
        Set-Location $stsadmpath
        $site = $_.Site
        $file = &quot;$location\&quot; &#43; $_.Site.Replace(&quot;http://&quot;,&quot;&quot;).Replace(&quot;https://&quot;,&quot;&quot;).Replace(&quot;/&quot;,&quot;_&quot;).Replace(&quot;;&quot;,&quot;_&quot;) &#43; &quot;.bak&quot;
        $DateStrForLog = &quot;{0:dd/MM/yyyy hh:mm:ss}&quot; -f (get-date)
        if ((Test-Path $file) -eq $True)
        	{
            $result = .\stsadm.exe -o restore -url $site -filename $file -overwrite
            $DateStrForLog = &quot;{0:dd/MM/yyyy hh:mm:ss}&quot; -f (get-date)
            if ($result -eq &quot;Operation completed successfully.&quot;)
            	{
                .\stsadm.exe -o refreshsitedms -url $site | out-null
                .\stsadm.exe -o setsitelock -url $site -lock none | out-null
                write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
                write-host -ForegroundColor green  &quot;The &quot; -nonewline 
                write-host -ForegroundColor magenta $site -nonewline 
                write-host -ForegroundColor green &quot; has been restored from &quot; -nonewline 
                write-host -ForegroundColor yellow $file -nonewline
                write-host -ForegroundColor green `n $result
                $logentry = &quot;[$DateStrForLog] The $site has been restored from `&quot;$file`&quot;&quot; | 
                out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                $result | out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                }
                else
                {
                write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
                write-host -ForegroundColor green &quot;The &quot; -nonewline
                write-host -ForegroundColor red $site -nonewline
                write-host -ForegroundColor green &quot; site could not be found!&quot; `n $result
                $logentry = &quot;[$DateStrForLog] The $site site has not been restored correctly! $result&quot; | 
                out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                $result = &quot;The site has not been restored correctly!&quot; |  
				out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
                $site | out-file $logpath\$DateStr&quot;-sitesnotfound.log&quot; -Append
                }
            }
            else
            {
            write-host -ForegroundColor magenta &quot;[$DateStrForLog] &quot; -nonewline
            write-host -ForegroundColor green &quot;The &quot; -nonewline
            write-host -ForegroundColor red $file -nonewline
            write-host -ForegroundColor green &quot; backup file could not be found!&quot;`n
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
            $logentry = &quot;[$DateStrForLog] The $file backup file could not be found!&quot; |  
            out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
            $result = &quot;&quot; |  out-file $logpath\$DateStr&quot;-restore.log&quot; -Append
            }   
        }
        Write-Host -ForegroundColor green &quot;Done.&quot;
        Set-Location $location
      }
		
	#Quit from job.
    3 {&quot;QUIT&quot;
      Set-Location $location;
      break OuterLoop
      }
  }
}
while ($y -ne 100)</pre>
<div class="preview">
<pre class="powershell"><span class="powerShell__keyword">param</span>&nbsp;(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[Parameter(Mandatory=<span class="powerShell__variable">$true</span>)]&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[string]<span class="powerShell__variable">$importfile</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;[string]<span class="powerShell__variable">$logpath</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;
&nbsp;
<span class="powerShell__com">#Check&nbsp;SharePoint&nbsp;major&nbsp;build&nbsp;version.&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;
[Void][System.Reflection.Assembly]::LoadWithPartialName(<span class="powerShell__string">&quot;Microsoft.SharePoint&quot;</span>)&nbsp;
<span class="powerShell__variable">$SPFarm</span>&nbsp;=&nbsp;[Microsoft.SharePoint.Administration.SPfarm]::Local&nbsp;
<span class="powerShell__variable">$version</span>&nbsp;=&nbsp;<span class="powerShell__variable">$SPFarm</span>.BuildVersion.Major&nbsp;
&nbsp;
<span class="powerShell__com">#Set&nbsp;up&nbsp;the&nbsp;STSADM&nbsp;command&nbsp;path&nbsp;regarding&nbsp;what&nbsp;is&nbsp;the&nbsp;major&nbsp;build&nbsp;version</span>&nbsp;
<span class="powerShell__variable">$stsadmpath</span>&nbsp;=&nbsp;&quot;c:\Program&nbsp;Files\Common&nbsp;Files\Microsoft&nbsp;Shared\Web&nbsp;Server&nbsp;Extensions\<span class="powerShell__variable">$version</span>\BIN\&quot;&nbsp;
&nbsp;
<span class="powerShell__com">#Set&nbsp;location&nbsp;where&nbsp;we&nbsp;are.</span>&nbsp;
<span class="powerShell__variable">$location</span>&nbsp;=&nbsp;<span class="powerShell__cmdlets">Get-Location</span>&nbsp;
<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$location</span>&nbsp;
&nbsp;
<span class="powerShell__com">#Create&nbsp;a&nbsp;log&nbsp;folder&nbsp;if&nbsp;we&nbsp;signed,&nbsp;anyway&nbsp;set&nbsp;it&nbsp;default&nbsp;location.</span>&nbsp;
<span class="powerShell__keyword">if</span>&nbsp;(<span class="powerShell__variable">$logpath</span>&nbsp;<span class="powerShell__operator">-</span>ne&nbsp;<span class="powerShell__string">&quot;&quot;</span>)&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="powerShell__cmdlets">New-Item</span>&nbsp;<span class="powerShell__operator">-</span>ItemType&nbsp;directory&nbsp;<span class="powerShell__operator">-</span>Path&nbsp;<span class="powerShell__variable">$logpath</span>&nbsp;<span class="powerShell__operator">-</span>erroraction&nbsp;SilentlyContinue&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;&gt;&nbsp;<span class="powerShell__variable">$null</span>&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="powerShell__variable">$logpath</span>&nbsp;<span class="powerShell__operator">&#43;</span>=&nbsp;<span class="powerShell__variable">$location</span>}&nbsp;
&nbsp;
<span class="powerShell__com">#Start&nbsp;working...</span>&nbsp;
<span class="powerShell__variable">$title</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;Work&nbsp;with&nbsp;SP&nbsp;sites&quot;</span>&nbsp;
<span class="powerShell__variable">$message</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;What&nbsp;do&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;site&nbsp;collection?&quot;</span>&nbsp;
&nbsp;
<span class="powerShell__com">#Create&nbsp;all&nbsp;choice&nbsp;for&nbsp;jobs&nbsp;as&nbsp;backup,&nbsp;delete,&nbsp;restore&nbsp;and&nbsp;quite.</span>&nbsp;
<span class="powerShell__variable">$backup</span>&nbsp;=&nbsp;<span class="powerShell__cmdlets">New-Object</span>&nbsp;System.Management.Automation.Host.ChoiceDescription&nbsp;<span class="powerShell__string">&quot;&amp;Backup&quot;</span>,&nbsp;`&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__string">&quot;Backup&nbsp;all&nbsp;site&nbsp;collection&nbsp;from&nbsp;source&nbsp;list.&quot;</span>&nbsp;
&nbsp;
<span class="powerShell__variable">$delete</span>&nbsp;=&nbsp;<span class="powerShell__cmdlets">New-Object</span>&nbsp;System.Management.Automation.Host.ChoiceDescription&nbsp;<span class="powerShell__string">&quot;&amp;Delete&quot;</span>,&nbsp;`&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__string">&quot;Delete&nbsp;all&nbsp;site&nbsp;collection&nbsp;from&nbsp;source&nbsp;list.&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class="powerShell__variable">$restore</span>&nbsp;=&nbsp;<span class="powerShell__cmdlets">New-Object</span>&nbsp;System.Management.Automation.Host.ChoiceDescription&nbsp;<span class="powerShell__string">&quot;&amp;Restore&quot;</span>,&nbsp;`&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__string">&quot;Restore&nbsp;all&nbsp;site&nbsp;collection&nbsp;from&nbsp;source&nbsp;list.&quot;</span>&nbsp;
&nbsp;
<span class="powerShell__variable">$quit</span>&nbsp;=&nbsp;<span class="powerShell__cmdlets">New-Object</span>&nbsp;System.Management.Automation.Host.ChoiceDescription&nbsp;<span class="powerShell__string">&quot;&amp;Quit&quot;</span>,&nbsp;`&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__string">&quot;Quit.&quot;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;
<span class="powerShell__com">#Initiate&nbsp;the&nbsp;menu.</span>&nbsp;
<span class="powerShell__variable">$options</span>&nbsp;=&nbsp;[System.Management.Automation.Host.ChoiceDescription[]](<span class="powerShell__variable">$backup</span>,&nbsp;<span class="powerShell__variable">$delete</span>,&nbsp;<span class="powerShell__variable">$restore</span>,&nbsp;<span class="powerShell__variable">$quit</span>)&nbsp;
&nbsp;
<span class="powerShell__com">#Do&nbsp;the&nbsp;jobs&nbsp;until&nbsp;you&nbsp;want&nbsp;to&nbsp;quit.</span>&nbsp;
:OuterLoop&nbsp;<span class="powerShell__keyword">do</span>&nbsp;
{&nbsp;
&nbsp;<span class="powerShell__com">#Initiate&nbsp;a&nbsp;prompt&nbsp;for&nbsp;choice.</span>&nbsp;
&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__variable">$host</span>.ui.PromptForChoice(<span class="powerShell__variable">$title</span>,&nbsp;<span class="powerShell__variable">$message</span>,&nbsp;<span class="powerShell__variable">$options</span>,&nbsp;0)&nbsp;&nbsp;
&nbsp;&nbsp;
&nbsp;<span class="powerShell__com">#Do&nbsp;the&nbsp;job&nbsp;what&nbsp;you&nbsp;choose.</span>&nbsp;
&nbsp;<span class="powerShell__keyword">switch</span>&nbsp;(<span class="powerShell__variable">$result</span>)&nbsp;
&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;<span class="powerShell__com">#Create&nbsp;a&nbsp;backup&nbsp;from&nbsp;all&nbsp;site&nbsp;collection&nbsp;what&nbsp;are&nbsp;in&nbsp;the&nbsp;.csv&nbsp;file.</span>&nbsp;
&nbsp;&nbsp;&nbsp;0&nbsp;{<span class="powerShell__string">&quot;BACKUP&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStr</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:ddMMyyyyhhmmss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Opening&nbsp;SharePoint&nbsp;site...&quot;</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__alias">ipcsv</span>&nbsp;<span class="powerShell__variable">$importfile</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">foreach</span>&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;=&nbsp;<span class="powerShell__variable">$_</span>.Site&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$file</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;$location\&quot;&nbsp;&#43;&nbsp;$_.Site.Replace(&quot;</span>http:<span class="powerShell__operator">/</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span><span class="powerShell__string">&quot;).Replace(&quot;</span>https:<span class="powerShell__operator">/</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span><span class="powerShell__string">&quot;).Replace(&quot;</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span>_<span class="powerShell__string">&quot;).Replace(&quot;</span>;<span class="powerShell__string">&quot;,&quot;</span>_<span class="powerShell__string">&quot;)&nbsp;&#43;&nbsp;&quot;</span>.bak&quot;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;.\stsadm.exe&nbsp;<span class="powerShell__operator">-</span>o&nbsp;backup&nbsp;<span class="powerShell__operator">-</span>url&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>filename&nbsp;<span class="powerShell__variable">$file</span>&nbsp;<span class="powerShell__operator">-</span>overwrite&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStrForLog</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:dd/MM/yyyy&nbsp;hh:mm:ss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">if</span>&nbsp;(<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">-</span>eq&nbsp;<span class="powerShell__string">&quot;Operation&nbsp;completed&nbsp;successfully.&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;has&nbsp;been&nbsp;backed&nbsp;up&nbsp;to&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;yellow&nbsp;<span class="powerShell__variable">$file</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;has&nbsp;been&nbsp;backed&nbsp;up&nbsp;to&nbsp;`&quot;</span><span class="powerShell__variable">$file</span>`<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;red&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;site&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;site&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;The&nbsp;site&nbsp;not&nbsp;found!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-backup.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-sitesnotfound.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Done.&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$location</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;<span class="powerShell__com">#Delete&nbsp;all&nbsp;site&nbsp;collection&nbsp;what&nbsp;are&nbsp;in&nbsp;the&nbsp;.csv&nbsp;file</span>&nbsp;
&nbsp;&nbsp;&nbsp;1&nbsp;{<span class="powerShell__string">&quot;DELETE&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStr</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:ddMMyyyyhhmmss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Opening&nbsp;SharePoint&nbsp;site...&quot;</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__alias">ipcsv</span>&nbsp;<span class="powerShell__variable">$importfile</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">foreach</span>&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;=&nbsp;<span class="powerShell__variable">$_</span>.Site&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;.\stsadm.exe&nbsp;<span class="powerShell__operator">-</span>o&nbsp;deletesite&nbsp;<span class="powerShell__operator">-</span>url&nbsp;<span class="powerShell__variable">$site</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStrForLog</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:dd/MM/yyyy&nbsp;hh:mm:ss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">if</span>&nbsp;(<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">-</span>eq&nbsp;<span class="powerShell__string">&quot;Operation&nbsp;completed&nbsp;successfully.&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;has&nbsp;been&nbsp;deleted!&nbsp;&quot;</span>&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;has&nbsp;been&nbsp;deleted!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;red&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;site&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;site&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&nbsp;$result&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;The&nbsp;site&nbsp;not&nbsp;found!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-delete.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-sitesnotfound.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Done.&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$location</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__com">#Restore&nbsp;all&nbsp;site&nbsp;collection&nbsp;what&nbsp;are&nbsp;in&nbsp;the&nbsp;.csv&nbsp;file.&nbsp;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__com">#WARNING:&nbsp;Check&nbsp;the&nbsp;connection&nbsp;of&nbsp;sites&nbsp;and&nbsp;backups!&nbsp;&nbsp;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;{<span class="powerShell__string">&quot;RESTORE&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStr</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:ddMMyyyyhhmmss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Opening&nbsp;SharePoint&nbsp;site...&quot;</span>&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__alias">ipcsv</span>&nbsp;<span class="powerShell__variable">$importfile</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">foreach</span>&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$stsadmpath</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;=&nbsp;<span class="powerShell__variable">$_</span>.Site&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$file</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;$location\&quot;&nbsp;&#43;&nbsp;$_.Site.Replace(&quot;</span>http:<span class="powerShell__operator">/</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span><span class="powerShell__string">&quot;).Replace(&quot;</span>https:<span class="powerShell__operator">/</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span><span class="powerShell__string">&quot;).Replace(&quot;</span><span class="powerShell__operator">/</span><span class="powerShell__string">&quot;,&quot;</span>_<span class="powerShell__string">&quot;).Replace(&quot;</span>;<span class="powerShell__string">&quot;,&quot;</span>_<span class="powerShell__string">&quot;)&nbsp;&#43;&nbsp;&quot;</span>.bak&quot;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStrForLog</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:dd/MM/yyyy&nbsp;hh:mm:ss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">if</span>&nbsp;((<span class="powerShell__cmdlets">Test-Path</span>&nbsp;<span class="powerShell__variable">$file</span>)&nbsp;<span class="powerShell__operator">-</span>eq&nbsp;<span class="powerShell__variable">$True</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;.\stsadm.exe&nbsp;<span class="powerShell__operator">-</span>o&nbsp;restore&nbsp;<span class="powerShell__operator">-</span>url&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>filename&nbsp;<span class="powerShell__variable">$file</span>&nbsp;<span class="powerShell__operator">-</span>overwrite&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$DateStrForLog</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;{0:dd/MM/yyyy&nbsp;hh:mm:ss}&quot;</span>&nbsp;<span class="powerShell__operator">-</span>f&nbsp;(<span class="powerShell__cmdlets">get-date</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">if</span>&nbsp;(<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">-</span>eq&nbsp;<span class="powerShell__string">&quot;Operation&nbsp;completed&nbsp;successfully.&quot;</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.\stsadm.exe&nbsp;<span class="powerShell__operator">-</span>o&nbsp;refreshsitedms&nbsp;<span class="powerShell__operator">-</span>url&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;<span class="powerShell__cmdlets">out-null</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.\stsadm.exe&nbsp;<span class="powerShell__operator">-</span>o&nbsp;setsitelock&nbsp;<span class="powerShell__operator">-</span>url&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>lock&nbsp;none&nbsp;<span class="powerShell__operator">|</span>&nbsp;<span class="powerShell__cmdlets">out-null</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;has&nbsp;been&nbsp;restored&nbsp;from&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;yellow&nbsp;<span class="powerShell__variable">$file</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;has&nbsp;been&nbsp;restored&nbsp;from&nbsp;`&quot;</span><span class="powerShell__variable">$file</span>`<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;red&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;site&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>&nbsp;`n&nbsp;<span class="powerShell__variable">$result</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$site&nbsp;site&nbsp;has&nbsp;not&nbsp;been&nbsp;restored&nbsp;correctly!&nbsp;$result&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;The&nbsp;site&nbsp;has&nbsp;not&nbsp;been&nbsp;restored&nbsp;correctly!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$site</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-sitesnotfound.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">else</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;magenta&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;The&nbsp;&quot;</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;red&nbsp;<span class="powerShell__variable">$file</span>&nbsp;<span class="powerShell__operator">-</span>nonewline&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write<span class="powerShell__operator">-</span>host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;&nbsp;backup&nbsp;file&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>`n&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$logentry</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;[$DateStrForLog]&nbsp;The&nbsp;$file&nbsp;backup&nbsp;file&nbsp;could&nbsp;not&nbsp;be&nbsp;found!&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__variable">$result</span>&nbsp;=&nbsp;<span class="powerShell__string">&quot;&quot;</span>&nbsp;<span class="powerShell__operator">|</span>&nbsp;&nbsp;out<span class="powerShell__operator">-</span>file&nbsp;<span class="powerShell__variable">$logpath</span>\<span class="powerShell__variable">$DateStr</span><span class="powerShell__string">&quot;-restore.log&quot;</span>&nbsp;<span class="powerShell__operator">-</span>Append&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write<span class="powerShell__operator">-</span>Host&nbsp;<span class="powerShell__operator">-</span>ForegroundColor&nbsp;green&nbsp;<span class="powerShell__string">&quot;Done.&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$location</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__com">#Quit&nbsp;from&nbsp;job.</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;{<span class="powerShell__string">&quot;QUIT&quot;</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__cmdlets">Set-Location</span>&nbsp;<span class="powerShell__variable">$location</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="powerShell__keyword">break</span>&nbsp;OuterLoop&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;}&nbsp;
}&nbsp;
<span class="powerShell__keyword">while</span>&nbsp;(<span class="powerShell__variable">$y</span>&nbsp;<span class="powerShell__operator">-</span>ne&nbsp;100)</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
<p>this script for.</p>

        </div>
    </body>
</html>